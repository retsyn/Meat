picotron cartridge // www.picotron.net
version 2

:: gfx/
:: gfx/0.gfx
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI1LTAxLTE3IDEwOjM1OjQ4Iixtb2RpZmllZD0iMjAyNS0w
NC0wNiAwMDo0OTowNSIscmV2aXNpb249MTE0OV1dbHo0AJ8FAADlNwAA8yF7WzBdPXtibXA9cHh1
AEMgEBAE8FYHEAfAF9AXwAcQB-BWLGZsYWdzPTAscGFuX3gIAMd5PTAsem9vbT04fSw_APwxICAE
8AIRYCHwAwEWAUABFgHwBBEGASABBgHwBwEGQQYB8AQhfx0R8AIRrhHwAQEuQQ5B8AEBHg0XEQcO
BxEHAQ0A8lIuDScNDg0XDQHAQQ0uLS4dDgGgIS4Rrg0BkBENTgEdDiE_DRGQAQ1eIW0hkBENXg0P
FYGwAQ1eDRxlAcABHS4dLGURoBEdQTxVDEFgAR0RJxElXAURFxFQAR0BRwGVATcBCgAlDIULAPQ0
jBE3AVARDREnERVMFSEXEWABHUEcZREAMXARPawB4CEdnBHwADF8IcDxBZARRRFAEUURcBFlAUAB
ZRFgAXUBQAF1AQgAHzA6AR0xIiFQOgEjETA6AX8REAEGEfAGOgFeQQ1OHRw6AeMuHTxVDAGgAS1B
DCVcBUQBFZVCAQ44AbABRwEVTBURNwFgAUQB4AxlMRcRYBENQYwBEDGAPQGfsHF8QZARRZE1NwE3
oCMhICHwBgEWEQA3AbAHEQYRBhHwByEGEXYCEBE1AfEAAxGeEfACAT5BDiHwAgEuKAE7AQcBDAAQ
PjMBwQcNAcBRTi0eDQ4RkDEBISFwMQGCHiEuDREHAXAzATAXAWA1ARGR6ABRXg0fFWXzAAFyApQh
FxFQER1BTEV0AkE1TAWwJAEklbA2AROgNAEUoGoCIRGwaAL-HyGwET1cgbAhHUwRZQHAMUwBdQHA
AUUBEAEVXAHAESUREAF8AdBBIAFcEfAHYWApAR0fAykBQwpaAgEpAQhaAkBBDxVxNwEB6gAwAQAB
VAMgDU4AAREVNAJAHS4dDA0AEQxMAhB9DAAhHAUMACBtHLIDAW4CsG0sQQwlQWABbQwFNgExXQwl
NAEhXSwzAQiZA5DwAsHwAwFFQQXJADBVAUUuA0NlAUUBBwAfYF4CdAo1ARNBNAFBMScRDTYBMSFH
IY8DYg8VBQFHEZIDMQFHIZMDECxZA-EGAaABfQwlQQwFAaABbRyVMXABbSyFXAEBIwEzJwFgJQEx
JwFwJwHwCScBcBEtgSwhFxGAQWUBHBEAMaAhdTHwA1sCQPAGAXwFAG9cIfAGccAiAR1P----8zQA
GQBjBh-wMQBK-wIICATwAxdANzA3MAYXBkAWoD0AHP8EgA8WNw4QVxBXEAY3BhAONg4wHkMAHf8F
AAYHFgcGACYXpg8WFh4WDqAe8ANDAB3-AQ8WBhAGDgCOEB4QDrAO8AtAAB9-MAXwBQXwE54BHg8x
AP-----------4b-LQDIDxgAyC5ILhheOC4YbhguOF4CCC4YjgIIDjiOAgjeAgieQghucghOIk4S
CB4yXiKegg6yESJhMgDRAGsAHIUPEwMeAx4DDgIAIg8bCAAhDQ4ZACELDQsAUAs_Aw0eDAB0Cx4D
Cw4DDQgAMR4DDQ4AYA8UHgMeEwQA8DYOHxVPFA4DDA4sDgwfFQwUDApMFAwKDAosChwUDDQcOhwk
HBQMChw0CiwaHBoMRAwqHEocBEwaDCQcGgwaFCw0DAoMGgwGAGEEHCocCgw8AD8MGgzXABzwAz8U
DxUPFBQeDxUeFB4UDg0uHQQA8CkkHQ4dDgQNLh0_LS49Dg0eLQ4EDSQODQ4EPQ49Lh0eHV5NDj0O
FA4NThQODQ4NLg0eFA40Hj0eJEIAMB40DSMA8AkORA4tHk0eBE4dDiQeHQ4dFC40Dg0OHQ4GACAE
HusNATwAPw4dDlYCHg8xAP--------------o-8fHxUyDjJuIi4S-hMSLhLOMh4izjIuAo4SLiIu
Es5CviJOMr4yjgIuEj4SLhL_F44AHg8xAP-------------------------------z9QbT04fX0=
:: gfx/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI1LTAxLTE3IDEwOjM3OjQ1Iixtb2RpZmllZD0iMjAyNS0w
NC0wNiAwMDo0OTowNiJdXQ==
:: map/
:: map/0.map
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI1LTAxLTE3IDEwOjM1OjQ4Iixtb2RpZmllZD0iMjAyNS0w
NC0wNiAwMDo0OTowNSIscmV2aXNpb249MTE1NV1dbHo0AKUFAABwAAEA8Ql7e2JtcD11c2VyZGF0
YSgiaTE2IiwxMjgEAC8iMAEA----------------------------------------------------
------------------------------8sHzQEAAIPAQD-2B80BAACDwEA-9gfNAQAAg8BAP-YHzQE
AAIPAQD-2B80BAACDwEAVy80MAEA-2wfNAQAIg8BADcvNDABAP9sHzQEACIPAQD-1B80BAAGDwEA
-9QfNAQABg8BAP------5B80BAAuDwEA-6wBxAEfMgQAJQ8AAv------uQ8EACoPAQD---------
------8PLzQxBAAbDwEA-74vNDIEABsPAQD-vi80MgQAGw8BAP__LzQyBAAbDwEADS80MQQACw8B
AP9_HzgEABgBBAIfMdABCy80MgQACw8BAP9_HzgEABguNDIEAAwBAC80MgQADB8xBAAPDwEA-1of
OAQAGC80MgQAABsxBAAfMgQALw8BAP9aHzgEABgvNDIEAFQeMQQADwEA-0YfOAQAfC80MgQAAw8B
AMEPlB1xHzgEAHwvNDIEAAMPAAL-Rhs0BAAfOAQAbC80MgQAAw8BAMEvNDCEAHMIBAAfOAQAhg8B
AL8vNDCEAHMPBAAFHzgEAJQPAQAJFzQEAA8BAH0PlABxKzQyBAAfMAQACx84BACADwEACRc0BAAP
AQB9D5QAcS80MgQAAB8wBAAXHzgEAHAPAQAJHzQEAAgIAQAbNAQADwEAIR80BAAQCAEALzQwAQBv
LzQyBAAUHzAEAGsfOAQACBw0BAAHOBAvNDIEAAgBAgEDNAAPBAAADwEAHQE4AB8yBAAIGjABAC80
MAEAby80MgQAGB8wBABnHzgEAAgcNAQAHzIEABQBAgEDNAAHBAAbMAwADwEAFQE0AB8yBAAIGjAB
AC80MAEAby80MgQAGBswBAAfMgQABB8wBAA-HzgEAAgcNAQAHzIEABQDMAAqMDAMAA8BACUBRAAf
MgQACBowAQAvNDABAG8vNDIEAEAfMAQAQBcxDAAIFAAPGAABHzIEABQfMAEAOy80MHAAGy80MAEA
by80MgQAQB8wBABAHzIUAAEPBAAsHzABAAsfNAQAFAQBAAEQAB8yBAAIACUAGjEwAA8BAG0vNDIE
AJgbMAQAHzIEACwfMAEACA9kABEDJAAEAQABEAAfMgQACB4wBAAPAQD-ah80IAAQLzQyBAAIHzAE
AB0PAQD-fB80IAAQLzQyBAAIHzABAP_sHzQgABAvNDIEAAgWMAEALzQwAQD-oB80IAAQDwQACw8B
AP_sD8ABLg8AAv---3sfNAQAAg8BAAsvNDABAO8bNAQADwEAZR80BAAQDwEABR80BAAmDwEA7x40
BAAPAQBOHzQEADAEAQAMEAAPAQD-Hh80BAAQCAEAHzQEAAIPAQATHzQEABwIAQAfNAQACg8BAP8o
HzQEABAIAQAfNAQAAg8BAEMXNAQACAEALzQwAQD-bB40BAAPAQD-2x40BAAPAQD-------------
-------------------------------------------------------------------------2cf
NAQAAg8BAP-YLjQyBAAPAAL-----8S80MgQAFw8BAK0vNDIAAv--fS80MgQArw8BAJkvNDIAAgMf
NJAAZg8AAv8ELzQxBAADDAEADhgAD1QADB8yBAABDwAC-4EWMggACQQAHjEEAA4YAA8oAAgP-AEC
DwACMy80MgQA5w8BAD0vNDIEAFgOvAEPBAD-SB8xBAAUDgAEDwQAMPEcIiksaGlkZGVuPWZhbHNl
LG5hbWU9ImNvbGxpZGFibGUiLHBhbl94PTkzOQoA8gB5PTk4NCx0aWxlX2g9MTYKABB3CgCAem9v
bT0xfX0=
:: map/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI1LTAxLTE3IDEwOjM3OjQ1Iixtb2RpZmllZD0iMjAyNS0w
NC0wNiAwMDo0OTowNiJdXQ==
:: sfx/
:: sfx/0.sfx
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI1LTAxLTE3IDEwOjM1OjQ5Iixtb2RpZmllZD0iMjAyNS0w
NC0wNiAwMDo0OTowNSIscmV2aXNpb249MTExMl1dbHo0AKAAAAALCgAA-zBweHUAAygAAAQABA9A
EAIOAAGgASACoA4ADxAADfDKAQIDQA8PkAQFBgdADJAICQoLQAyQDwwPDQ8ODEAM8P8BAOv-J6oB
EAYPIBABIAEgAfAAAhACDhABIA8hIAEwD0Dwww8oD--wxg-4Cg--D4AP9w8NAfAJARAGDjAA----
--_9H-8BAKzPyA9AAA8QQP--sPD-AQD-6lD-----KQ==
:: sfx/.info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI1LTAxLTE3IDEwOjM3OjQ1Iixtb2RpZmllZD0iMjAyNS0w
NC0wNiAwMDo0OTowNiJdXQ==
:: actors.lua
--[[pod_format="raw",created="2025-03-05 17:41:28",modified="2025-04-06 00:49:05",revision=1307]]
-- Actor module for MEAT
include "data.lua" -- For sprite info
include "tilemap.lua" -- For tilemap interaction

-- global table
actors = {}


function create_actor(type, newx, newy, playable)
	local new_actor = {}
	
	-- Essentials
	new_actor.is_playable = playable
	
	-- Sprite Info
	new_actor.sprite_index = type
	new_actor.x = newx
	new_actor.y = newy
	new_actor.hflip = false
	new_actor.vflip = false
	
	-- Rect Info
	new_actor.w = 32
	new_actor.h = 32
	
	-- Collision Stats
	new_actor.sideskin = 4
	new_actor.topskin = 3
		
	-- Animation Data
	new_actor.animreel = generic_anims.idle
	new_actor.ticker = 0
	new_actor.animspeed = 5
	new_actor.frame = 1
	
	-- Physics Data
	new_actor.vx = 0
	new_actor.vy = 0
	new_actor.gfriction = 0.25
	new_actor.afriction = 0.01
	
	-- Character Movement info
	new_actor.accel = 0.5
	new_actor.gspeed = 2.0
	
	-- "AI" thinking
	new_actor.thought_time = 100
	new_actor.thought_tick = 0
		
	-- Drawing actors:
	function new_actor:draw()
		-- Must catch if previous anim frame is higher than the reel allows
		if(self.frame > #self.animreel) then
			self.frame = 1
		end

		spr(self.sprite_index + self.animreel[self.frame], self.x, self.y, self.hflip, self.vflip)
	end
	
	function new_actor:collision()	
		nx = self.x + self.vx
		ny = self.y + self.vy

		-- Collision		
		-- down
		if(self.vy > 0) then
			for i = math.floor(self.y), math.floor(ny) do
				if is_solid16(nx + self.sideskin + 2, i + self.h) or is_solid16(nx + self.w - self.sideskin - 1, i + self.h) then
					self.vy = 0
					self.y = i
					break
				end
			end
		end
		
		-- up
		if(self.vy < 0) then
			for i = math.floor(self.y), math.floor(ny), -1 do
				-- The "sideskin + 2" is because floor() biases to the left.
				if is_solid16(nx + self.sideskin + 2, i + 1) or is_solid16(nx + self.w - self.sideskin - 1, i) then
					self.vy = 0
					self.y = i
					break
				end
			end
		end

		-- left
		if(self.vx < 0) then
			for i = math.floor(self.x), math.floor(nx), -1 do
				if is_solid16(i + self.sideskin, self.y + self.topskin) or is_solid16(i + self.sideskin, self.y + self.h - 1) then
					self.vx = 0
					self.x = i
					break
				end
			end
		end

		-- right
		if(self.vx > 0) then
			for i = math.floor(self.x), math.floor(nx) do
				if is_solid16(i + self.w - self.sideskin, self.y + self.topskin) or is_solid16(i + self.w - self.sideskin, self.y + self.h - 1) then
					self.vx = 0
					self.x = i
					break
				end
			end
		end
	end
	
	function new_actor:physics()
		-- Apply Gravity
		self.vy += 0.25
		
		self:collision()	

		-- Apply velocities
		self.x += self.vx
		self.y += self.vy

		-- On Ground physics only:
		if(self.vx > 0 and self.vx > self.gspeed) then
			self.vx = self.gspeed
		elseif (self.vx < 0 and self.vx < -self.gspeed) then
			self.vx = -self.gspeed
		end
		
		if(self.vx > 0) then
			self.vx -= self.gfriction
		elseif(self.vx < 0) then
			self.vx += self.gfriction
		end
		
		-- Friction "juggle" fix
		if(abs(self.vx) < self.gfriction) then
			self.vx = 0
		end
	end
	
	function new_actor:animate()
	
		-- Based on physics, choose reel:
		if(abs(self.vx) > 0) then
			self.animreel = generic_anims.walk
		else
			self.animreel = generic_anims.idle
		end

		self.ticker += 1
		if(self.ticker > self.animspeed) then
			self.ticker = 0
			self.frame += 1
			if(self.frame > #self.animreel) then
				self.frame = 1
			end
		end
	end
	
	function new_actor:get_input()
		if(btn(0)) then
			self.vx -= self.accel
			self.hflip = true
		end
		
		if(btn(1)) then
			self.vx += self.accel
			self.hflip = false
		end
		
		if(btn(4)) then
			self.vy = - 5
		end
	end
	
	function new_actor:ai()
		self.thought_tick -= 1
		if(self.thought_tick <= 0) then
			self.thought_tick = self.thought_time + rnd(25)
			self.hflip = not self.hflip
		end
		
		if(self.hflip) then
			self.vx -= self.accel
		else
			self.vx += self.accel
		end
	end
	
	function new_actor:control()
		if(self.is_playable) then
			self:get_input()
		else
			self:ai()
		end
	end
	
	add(actors, new_actor)
end


:: camera.lua
--[[pod_format="raw",created="2025-04-04 15:48:10",modified="2025-04-06 00:49:05",revision=307]]
-- The camera module!

camerax = 0
cameray = 0
camera_bx = 40
camera_by = 16
world_bound = true
tsize = 16
mapw = 128
maph = 128

function update_camera()
	if(world_bound) then
		if(camerax < 0) then
	 		camerax = 0
		end
		if(cameray < 0) then
			cameray = 0
		end
		
		if(camerax > (mapw * tsize) - 480) then
			camerax = (mapw * tsize) - 480
		end
		if(cameray > (maph * tsize) - 270) then
			cameray = maph * tsize - 270
		end
	end

	camera(camerax, cameray)
	
	
end


function lock_camera(entity)
	camerax = entity.x - 256 + entity.w / 2
	cameray = entity.y - 128 + entity.h / 2
end


function bound_camera(entity)
	local px = entity.x - 256 + entity.w / 2
	local py = entity.y - 128 + entity.h / 2

	if px > camerax + camera_bx then
		camerax = px - camera_bx
	elseif px < camerax - camera_bx then
		camerax = px + camera_bx
	end

	if py > cameray + camera_by then
		cameray = py - camera_by
	elseif py < cameray - camera_by then
		cameray = py + camera_by
	end
end
:: data.lua
--[[pod_format="raw",created="2025-03-05 18:46:07",modified="2025-04-06 00:49:05",revision=850]]
-- Data stuff

generic_anims = {
	idle = {0, 1},
	walk = {2, 3, 4, 3},
}
:: ephemerals.lua
--[[pod_format="raw",created="2025-04-06 00:13:16",modified="2025-04-06 00:49:05",revision=131]]
-- Ephemerals Module, for particles and things that don't last.

ephemerals = {}


function create_ephem(type, newx, newy, vx, vy)
	local new_ephem = {}
	
	new_ephem.sprite_index = type
	new_ephem.x = newx
	new_ephem.y = newy
	new_ephem.vx = vx
	new_ephem.vy = vy
	new_ephem.frame = 0
	new_ephem.animspeed = 5
	new_ephem.animticker = 0
	new_ephem.grav = 0
	new_ephem.delete = false
	new_ephem.frame_count = 5
	
	function new_ephem:draw()
		spr(self.sprite_index + self.frame, self.x, self.y)
	end
	
	function new_ephem:animate()
		self.animticker += 1
		if(self.animticker >= self.animspeed) then
			self.animticker = 0
			self.frame += 1
			if(self.frame > self.frame_count) then
				self.delete = true
			end
		end
	end
	
	function new_ephem:update()
		self.x += self.vx
		self.y += self.vy + self.grav
		
		if self.delete then
			for i, e in ipairs(ephemerals) do
				if e == self then
					del(ephemerals, self)
					break
				end
			end
		end		
	end
	
	add(ephemerals, new_ephem)
end
:: main.lua
--[[pod_format="raw",created="2025-01-17 10:35:48",modified="2025-04-06 00:49:05",revision=1232]]
include "actors.lua"
include "camera.lua"
include "ephemerals.lua"

function _init()
	create_actor(1, 100, 20, true)
	create_actor(1, 200, 100)
	create_actor(1, 260, 100)
end


function _update()

	-- Update Actors
	for i, actor in ipairs(actors) do
		actor:control()
		actor:physics()
	end
		
	for i, ephem in ipairs(ephemerals) do
		ephem:update()
	end
	
	bound_camera(actors[1])

end


function _draw()
	cls(12)
	
	map(0,0,0,0,128,128)
	update_camera()

	for i, actor in ipairs(actors) do
		actor:animate()
		actor:draw()
	end
	
	for i, ephem in ipairs(ephemerals) do
		ephem:animate()
		ephem:draw()
	end

	print ("CAMX:" .. camerax .. "\nCAMY:" .. cameray, camerax, cameray)
	print ("CAMTILE_X:" .. flr(camerax / tsize) .. "\nCAMTILE_Y:" .. flr(cameray / tsize), camerax, cameray + 22)
end
:: tilemap.lua
--[[pod_format="raw",created="2025-04-01 17:23:51",modified="2025-04-06 00:49:05",revision=738]]
-- Tilemap module for MEAT
include "utils.lua"


function is_solid16(x, y)

	if(mget(x // 16, y // 16, 0) != 0) then
		return true
	else 
		return false
	end
end
	

:: utils.lua
--[[pod_format="raw",created="2025-04-02 01:12:55",modified="2025-04-06 00:12:53",revision=512]]
-- Utility funcs that a Python boy usually expects to just be there.

function contains(list, value)
	for _, v in ipairs(list) do
   	if v == value then
			return true
		end
	end
	return false
end
:: utils.py
b64$LS1bW3BvZF9mb3JtYXQ9InJhdyIsY3JlYXRlZD0iMjAyNS0wNC0wMiAwMDoxNTozMyIsbW9k
aWZpZWQ9IjIwMjUtMDQtMDIgMDE6MTI6MzMiLHJldmlzaW9uPTUzXV0KLS0gVXRpbGl0eSBmdW5j
cyB0aGF0IGEgUHl0aG9uIGJveSB1c3VhbGx5IGV4cGVjdHMgdG8ganVzdCBiZSB0aGVyZS4KCmZ1
bmN0aW9uIGNvbnRhaW5zKGxpc3QsIHZhbHVlKQoJZm9yIF8sIHYgaW4gaXBhaXJzKGxpc3QpIGRv
CiAgIAlpZiB2ID09IHZhbHVlIHRoZW4KCQkJcmV0dXJuIHRydWUKCQllbmQKCWVuZAoJcmV0dXJu
IGZhbHNlCmVuZA==
:: .info.pod
b64$LS1bW3BvZCxjcmVhdGVkPSIyMDI1LTAxLTE3IDEwOjM3OjQ1Iixtb2RpZmllZD0iMjAyNS0w
NC0wNiAwMDo0OTowNiIscnVudGltZT0xNyx3b3Jrc3BhY2VzPXt7bG9jYXRpb249Im1haW4ubHVh
IzEiLHdvcmtzcGFjZV9pbmRleD0xfSx7bG9jYXRpb249ImFjdG9ycy5sdWEjMSIsd29ya3NwYWNl
X2luZGV4PTF9LHtsb2NhdGlvbj0iZGF0YS5sdWEjMSIsd29ya3NwYWNlX2luZGV4PTF9LHtsb2Nh
dGlvbj0idGlsZW1hcC5sdWEjMSIsd29ya3NwYWNlX2luZGV4PTF9LHtsb2NhdGlvbj0iY2FtZXJh
Lmx1YSMxIix3b3Jrc3BhY2VfaW5kZXg9MX0se2xvY2F0aW9uPSJlcGhlbWVyYWxzLmx1YSMyMCIs
d29ya3NwYWNlX2luZGV4PTF9LHtsb2NhdGlvbj0iZ2Z4LzAuZ2Z4Iix3b3Jrc3BhY2VfaW5kZXg9
Mn0se2xvY2F0aW9uPSJtYXAvMC5tYXAiLHdvcmtzcGFjZV9pbmRleD0zfSx7bG9jYXRpb249InNm
eC8wLnNmeCIsd29ya3NwYWNlX2luZGV4PTR9fV1d
:: [eoc]
